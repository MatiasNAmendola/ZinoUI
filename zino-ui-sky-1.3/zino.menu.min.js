/*!
 * ZinoUI v1.3 (http://zinoui.com)
 * Copyright 2012-2013 Dimitar Ivanov. All Rights Reserved.
 *
 * Zino UI commercial licenses may be obtained at http://zinoui.com/license
 * If you do not own a commercial license, this file shall be governed by the
 * GNU General Public License (GPL) version 3.
 * For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
 */
(function(b,l){function p(){this._defaults={dataSource:null,orientation:"horizontal",open:null,close:null,enable:null,disable:null}}p.prototype={_attachMenu:function(a,c){if(this._getInst(a))return!1;var d=b(a),e=this,f=e._newInst(d);b.extend(f.settings,e._defaults,c);d.on("mouseenter.menu",".zui-menubar-item",function(b){e._openMenu.call(e,a,this);return!0}).on("mouseleave.menu",".zui-menubar-item",function(b){e._closeMenu.call(e,a,this);return!0}).on("focus.menu",".zui-menubar-item",function(a){b(".zui-menubar-item[aria-haspopup='true']").not(this).trigger("mouseleave");
b(this).addClass("zui-menubar-item-focus");return!0}).on("blur.menu",".zui-menubar-item",function(a){b(this).removeClass("zui-menubar-item-focus");return!0}).on("mouseenter.menu",".zui-menu-item",function(a){b(this).addClass("zui-menu-item-hover");return!0}).on("mouseleave.menu",".zui-menu-item",function(a){b(this).removeClass("zui-menu-item-hover");return!0}).on("focus.menu",".zui-menu-item",function(a){return!0}).on("blur.menu",".zui-menu-item",function(a){return!0}).on("keydown.menu",".zui-menubar-item",
function(a){a.stopPropagation();a.preventDefault();switch(a.charCode?a.charCode:a.keyCode?a.keyCode:0){case 37:b(a.target).prev().trigger("focus");break;case 38:b(a.target).trigger("mouseenter").find(".zui-menu-item").filter(":last").trigger("focus").trigger("mouseenter");break;case 39:b(a.target).next().trigger("focus");break;case 40:b(a.target).trigger("mouseenter").find(".zui-menu-item").filter(":first").trigger("focus").trigger("mouseenter")}return!0}).on("keydown.menu",".zui-menu-item",function(a){a.stopPropagation();
a.preventDefault();switch(a.charCode?a.charCode:a.keyCode?a.keyCode:0){case 37:b(this).trigger("mouseleave").closest(".zui-menubar-item").prev().trigger("focus").trigger("mouseenter").find(".zui-menu-item").filter(":first").trigger("focus").trigger("mouseenter");break;case 38:var c=b(a.target).prev();c.get(0)===l&&(c=b(a.target).siblings().filter(":last"));c.trigger("focus").trigger("mouseenter").siblings().removeClass("zui-menu-item-hover");break;case 39:b(this).trigger("mouseleave").closest(".zui-menubar-item").next().trigger("focus").trigger("mouseenter").find(".zui-menu-item").filter(":first").trigger("focus").trigger("mouseenter");
break;case 40:c=b(a.target).next();c.get(0)===l&&(c=b(a.target).siblings().filter(":first"));c.trigger("focus").trigger("mouseenter").siblings().removeClass("zui-menu-item-hover");break;case 27:b(a.target).removeClass("zui-menu-item-hover").trigger("blur").closest(".zui-menu").hide().attr("aria-hidden","true").closest(".zui-menubar-item")}return!0}).bind("menuenable",function(b,c){null!==f.settings.enable&&f.settings.enable.call(a,b,c)}).bind("menudisable",function(b,c){null!==f.settings.disable&&
f.settings.disable.call(a,b,c)}).bind("menuopen",function(b,c){null!==f.settings.open&&f.settings.open.call(a,b,c)}).bind("menuclose",function(b,c){null!==f.settings.close&&f.settings.close.call(a,b,c)});b.data(a,"menu",f);e._renderMenu.call(e,a)},_destroyMenu:function(a){if(!this._getInst(a))return!1;var c=b(a);"UL"===a.nodeName?c.removeAttr("role").removeClass("zui-menubar zui-menubar-horizontal zui-menubar-vertical").children("li").removeAttr("role").removeAttr("aria-disabled").removeAttr("aria-haspopup").removeClass("zui-menubar-item zui-menubar-item-hover zui-menubar-item-disabled").children("ul").removeAttr("role").removeAttr("aria-hidden").removeClass("zui-menu").children("li").removeAttr("role").removeAttr("aria-disabled").removeClass("zui-menu-item zui-menu-item-hover"):
c.children().remove();b.data(a,"menu",!1)},getItem:function(a,c){var d;switch(typeof c){case "number":d=a.hasClass("zui-menubar")?a.children(".zui-menubar-item").eq(c):b(".zui-menubar",a).children(".zui-menubar-item").eq(c);break;case "string":d=b(c);break;case "object":c instanceof jQuery?d=c:c.nodeType&&(d=b(c))}return d},_enableMenu:function(a,c){if(!this._getInst(a))return!1;var d=b(a),e=this.getItem(d,c);if("false"===e.attr("aria-disabled"))return!1;e.attr("aria-disabled","false").removeClass("zui-menubar-item-disabled");
d.trigger("menuenable",{index:c})},_disableMenu:function(a,c){if(!this._getInst(a))return!1;var d=b(a),e=this.getItem(d,c);if("true"===e.attr("aria-disabled"))return!1;e.attr("aria-disabled","true").addClass("zui-menubar-item-disabled");e.children(".zui-menu").is(":visible")&&e.trigger("mouseleave");d.trigger("menudisable",{index:c})},_closeMenu:function(a,c){if(!this._getInst(a))return!1;var d,e=b(a);d=this.getItem(e,c);d.removeClass("zui-menubar-item-hover");d=d.children(".zui-menu");if(!d.is(":visible"))return!1;
d.hide().attr("aria-hidden","true");e.trigger("menuclose",{index:c})},_openMenu:function(a,c){if(!this._getInst(a))return!1;var d,e=b(a),f=this.getItem(e,c);d=f.children(".zui-menu");if(d.is(":visible")||"true"===f.attr("aria-disabled"))return!1;f.addClass("zui-menubar-item-hover");d.show().attr("aria-hidden","false");e.trigger("menuopen",{index:c})},_renderMenu:function(a){var c=this._getInst(a);if(!c)return!1;var d,e,f,g,n,h,m,k=b(a);if("UL"===a.nodeName){k.attr("role","menubar").addClass("zui-menubar").find("ul").hide();
switch(c.settings.orientation){case "horizontal":k.addClass("zui-menubar-horizontal");break;case "vertical":k.addClass("zui-menubar-vertical")}k.children("li").attr({role:"menuitem","aria-disabled":"false"}).addClass("zui-menubar-item").each(function(a,c){b(c).attr("aria-haspopup",b(c).children("ul").get(0)!=l?"true":"false").attr("tabindex",0<a?-1:0)}).end().find("ul").attr("role","menu").addClass("zui-menu").children("li").attr("tabindex",-1).attr({role:"menuitem","aria-disabled":"false"}).addClass("zui-menu-item")}else c.settings.dataSource.load(function(a){d=
b("<ul>",{role:"menubar"}).addClass("zui-menubar zui-menubar-"+c.settings.orientation);g=m=0;for(n=a.length;g<n;g++)if(0==a[g].parent_id){f=b("<li>").attr("role","menuitem").attr("tabindex",0<m?-1:0).addClass("zui-menubar-item");b("<a>",{href:a[g].url}).html(a[g].text).appendTo(f);e=b("<ul>",{"aria-hidden":"true",role:"menu"}).hide().addClass("zui-menu");for(h=0;h<n;h++)a[h].parent_id==a[g].id&&b("<li>").attr("role","menuitem").attr("tabindex",-1).addClass("zui-menu-item").append(b("<a>",{href:a[h].url}).html(a[h].text)).appendTo(e);
e.children().get(0)!=l?(e.appendTo(f),f.attr("aria-haspopup","true")):f.attr("aria-haspopup","false");f.appendTo(d);m+=1}d.appendTo(k)});b.data(a,"menu",c)},_newInst:function(a){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:a,uid:Math.floor(99999999*Math.random()),isDisabled:!1,settings:{}}},_getInst:function(a){try{return b.data(a,"menu")}catch(c){throw"Missing instance data for this menu";}}};b.fn.zinoMenu=function(a){var c=Array.prototype.slice.call(arguments,1);return"string"==
typeof a&&"isDisabled"==a||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?b.zinoMenu["_"+a+"Menu"].apply(b.zinoMenu,[this[0]].concat(c)):this.each(function(){"string"==typeof a?b.zinoMenu["_"+a+"Menu"].apply(b.zinoMenu,[this].concat(c)):b.zinoMenu._attachMenu(this,a)})};b.zinoMenu=new p;b.zinoMenu.version="1.3"})(jQuery);