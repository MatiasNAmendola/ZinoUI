/*!
 * ZinoUI v1.3 (http://zinoui.com)
 * Copyright 2012-2013 Dimitar Ivanov. All Rights Reserved.
 *
 * Zino UI commercial licenses may be obtained at http://zinoui.com/license
 * If you do not own a commercial license, this file shall be governed by the
 * GNU General Public License (GPL) version 3.
 * For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
 */
(function(b,p){function l(){this._defaults={autocomplete:!1,dataSource:null,multiple:!1};this._events={change:null,close:null,open:null,select:null}}l.prototype={_attachCombobox:function(a,c){if(this._getInst(a))return!1;var k,f,m,g=b(a),h=this,e=h._newInst(g);b.extend(e.settings,h._defaults,h._events,c);g.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"zui-combobox-listbox-"+e.uid,"aria-activedescendant":""}).addClass("zui-combobox zui-combobox-combo").wrap('<div class="zui-combobox-wrapper zui-unselectable" />').bind("comboboxopen",
function(b,d){null!==e.settings.open&&e.settings.open.call(a,b,d)}).bind("comboboxselect",function(b,d){null!==e.settings.select&&e.settings.select.call(a,b,d)}).bind("comboboxchange",function(b,d){null!==e.settings.change&&e.settings.change.call(a,b,d)}).bind("comboboxclose",function(b,d){null!==e.settings.close&&e.settings.close.call(a,b,d)});var l=g.width()+26,n=g.parent().offset();m=g.parent();m.css("width",l+"px");k=b("<div>",{id:"zui-combobox-"+e.uid}).hide().css({position:"absolute",top:n.top+
m.height()+1+"px",left:n.left+"px",width:l+"px"});f=b("<ul>",{role:"listbox",id:"zui-combobox-listbox-"+e.uid}).addClass("zui-combobox-list zui-unselectable");e.settings.dataSource.load(function(a){for(var d=0,c=a.length;d<c;d++)"object"===typeof this.opts.fields[0]?b("<li>",{role:"option",id:["zui-combobox-option-",e.uid,"-",d].join("")}).addClass("zui-combobox-item").text(a[d][this.opts.fields[0].name]).appendTo(f):b("<li>",{role:"option",id:["zui-combobox-option-",e.uid,"-",d].join("")}).addClass("zui-combobox-item").text(a[d][this.opts.fields[0]]).appendTo(f)});
b("<span>").addClass("zui-combobox-trigger zui-unselectable").bind("click.combobox",function(){k.is(":visible")?h._closeCombobox.call(h,a):h._openCombobox.call(h,a)}).append("<span />").appendTo(g.parent());f.on("mouseover.combobox",".zui-combobox-item",function(){b(this).addClass("zui-combobox-item-hover")}).on("mouseout.combobox",".zui-combobox-item",function(){b(this).removeClass("zui-combobox-item-hover")}).on("click.combobox",".zui-combobox-item",function(){var c=b(this);if(e.settings.multiple){g.val();
var c=c.text(),d=g.data("stack");if(d===p)g.data("stack",[c]),g.val(c).focus();else{var f=b.inArray(c,d);-1===f?d.push(c):d.splice(f,1);g.data("stack",d).val(d.join(", ")).focus()}}else h._selectCombobox.call(h,a,c.index()),h._closeCombobox.call(h,a)});if(e.settings.autocomplete)m.on("keyup.combobox",g,function(){var c=g.val();0<c.length?b("li",f).show().not("li:contains('"+c+"')").hide():b("li",f).show();k.is(":visible")||h._openCombobox.call(h,a)});f.appendTo(k);k.appendTo(document.body);b(window).off(".combobox").on("mousedown.combobox",
document.body,function(a){var c=b(a.target);c.hasClass("zui-combobox-item")||(c.hasClass("zui-combobox-trigger")||c.hasClass("zui-combobox")||c.hasClass("zui-combobox-wrapper"))||(a.stopPropagation(),b(".zui-combobox").zinoCombobox("close"))});e.list=f;e.container=k;b.data(a,"combobox",e)},_openCombobox:function(a){var c=this._getInst(a);if(!c)return!1;c.container.is(":visible")||(c.container.show(),b(a).attr("aria-expanded","true").trigger("comboboxopen",{}))},_selectCombobox:function(a,c){var k=
this._getInst(a);if(!k)return!1;var f;b.isNumeric(c)?f=b("li",k.list).eq(c):c instanceof jQuery&&(f=c);f.siblings("li").removeClass("zui-combobox-item-selected").end().addClass("zui-combobox-item-selected");b(a).trigger("comboboxselect",{index:c,item:f}).attr("aria-activedescendant",["zui-combobox-option-",k.uid,"-",f.index()].join("")).val(f.text()).focus().trigger("comboboxchange",{index:c,item:f})},_closeCombobox:function(a){var c=this._getInst(a);if(!c)return!1;c.container.is(":visible")&&(c.container.hide(),
b(a).attr("aria-expanded","false").trigger("comboboxclose",{}))},_newInst:function(a){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:a,uid:Math.floor(99999999*Math.random()),isDisabled:!1,settings:{}}},_getInst:function(a){try{return b.data(a,"combobox")}catch(c){throw"Missing instance data for this combobox";}}};b.fn.zinoCombobox=function(a){var c=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&"isDisabled"==a||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?
b.zinoCombobox["_"+a+"Combobox"].apply(b.zinoCombobox,[this[0]].concat(c)):this.each(function(){"string"==typeof a?b.zinoCombobox["_"+a+"Combobox"].apply(b.zinoCombobox,[this].concat(c)):b.zinoCombobox._attachCombobox(this,a)})};b.zinoCombobox=new l;b.zinoCombobox.version="1.3"})(jQuery);