/*!
 * ZinoUI v1.3 (http://zinoui.com)
 * Copyright 2012-2013 Dimitar Ivanov. All Rights Reserved.
 *
 * Zino UI commercial licenses may be obtained at http://zinoui.com/license
 * If you do not own a commercial license, this file shall be governed by the
 * GNU General Public License (GPL) version 3.
 * For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
 */
(function(l,e){function k(a){if(!(this instanceof k))return new k(a);this._total=this._pages=this._offset=0;this.originalData=[];this._view=[];this.cache=!1;this.callback=null;this.init.call(this,a);return this}function g(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function m(a){var c=1;"-"===a[0]&&(c=-1,a=a.substr(1,a.length-1));return function(b,d){return(b[a]<d[a]?-1:b[a]>d[a]?1:0)*c}}function n(){var a=arguments;return function(c,b){for(var d=0,h=0,f=a.length;0===h&&
d<f;)h=m(a[d])(c,b),d++;return h}}function p(a,c){switch(c.toLowerCase()){case "int":case "integer":case "numeric":return parseInt(a,10);case "bool":case "boolean":if("true"===a.toLowerCase()||"1"===a||1===a)return!0;if("false"===a.toLowerCase()||"0"===a||0===a)return!1;break;case "string":return a.toString();case "float":case "decimal":return parseFloat(a);case "date":return new Date(a)}}var q={autoLoad:!1,data:[],dataType:"array",dataUrl:null,fields:[],page:1,rowCount:20,xmlRoot:null,xmlRecord:null,
filter:null,sort:null,change:null};k.guid=function(){return[g(),g(),"-",g(),"-",g(),"-",g(),"-",g(),g(),g()].join("")};k.prototype={add:function(a){if(a===e)throw Error("Data item is undefined");a._zuid_=k.guid();this.opts.data.push(a);this.refresh.call(this);return this},cancel:function(){this.opts.data=this.originalData;$(this).trigger("datasourcechange",{});return this},data:function(){if(0===arguments.length)return this.opts.data;this.opts.data=arguments[0];return this},filter:function(){if(0===
arguments.length)return this.opts.filter;this.opts.filter=arguments[0];this._filter.call(this);return this},getById:function(a){for(var c=0,b=this.opts.data.length;c<b;c++)if(this.opts.data[c]._zuid_===a)return this.opts.data[c];return e},getByIndex:function(a){return this.opts.data[a]},init:function(a){var c=this;this.opts=$.extend(q,a);$(this).bind("datasourcechange",function(a,d){null!==c.opts.change&&c.opts.change.call(this,a,d)});this.opts.autoLoad&&this.load.call(this)},insert:function(a,c){if(c===
e)throw Error("Data item is undefined");this.opts.data.splice(a,0,c);this.refresh.call(this);return this},load:function(a){function c(a){for(var b=0,c=a.length;b<c;b++)a[b]._zuid_=k.guid();return a}var b=this;a!==e&&"function"===typeof a&&(b.callback=a);switch(this.opts.dataType){case "json":$.get(this.opts.dataUrl).done(function(d){b._total=d.length;b._pages=Math.ceil(b._total/b.opts.rowCount);b._offset=(parseInt(b.opts.page,10)-1)*b.opts.rowCount;b.opts.data=c(d);b._view=d.slice(b._offset,b._offset+
b.opts.rowCount);b.originalData=b.opts.data;b._sort.call(b);a!==e&&"function"===typeof a&&a.call(b,b._view)});break;case "xml":$.get(this.opts.dataUrl).done(function(d){var h=[];$($.parseXML(d)).find(b.opts.xmlRoot).find(b.opts.xmlRecord).each(function(a,c){h.push({});$(c).children().each(function(c,d){c=0;for(var e=b.opts.fields.length;c<e;c++)if("object"===typeof b.opts.fields[c]){if(this.nodeName===b.opts.fields[c].name){h[a][this.nodeName]=p($(d).text(),b.opts.fields[c].type);break}}else h[a][this.nodeName]=
$(d).text()})});b._total=h.length;b._pages=Math.ceil(b._total/b.opts.rowCount);b._offset=(parseInt(b.opts.page,10)-1)*b.opts.rowCount;b.opts.data=h.slice(b._offset,b._offset+b.opts.rowCount);b.opts.data=c(b.opts.data);b.originalData=b.opts.data;b._sort.call(b);a!==e&&"function"===typeof a&&a.call(b,b.opts.data)});break;default:this._total=this.opts.data.length,this.opts.data=c(this.opts.data),this.originalData=this.opts.data,this._sort.call(this),a!==e&&"function"===typeof a&&a.call(this,this.opts.data)}$(this).trigger("datasourcechange",
{});return this},page:function(){if(0===arguments.length)return this.opts.page;this.opts.page=parseInt(arguments[0],10);return this},pages:function(){return this._pages},refresh:function(){this.callback!==e&&(null!==this.callback&&"function"===typeof this.callback)&&(this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this._view=this.opts.data.slice(this._offset,this._offset+this.opts.rowCount),this._pages=Math.ceil(this._total/this.opts.rowCount),this.callback.call(this,this._view));
return this},remove:function(a){if(a===e)throw Error("Data item is undefined");for(var c=0,b=this.opts.data.length;c<b;c++)if(JSON.stringify(a)===JSON.stringify(this.opts.data[c])){this.opts.data.splice(c,1);break}this.refresh.call(this);return this},rowCount:function(){if(0===arguments.length)return this.opts.rowCount;this.opts.rowCount=parseInt(arguments[0],10);return this},sort:function(){if(0===arguments.length)return this.opts.sort;this.opts.sort=arguments[0];this._sort.call(this);return this},
total:function(){return this._total},_filter:function(){var a,c,b,d=this.opts.filter,e=d.length;this.opts.data=$.grep(this.originalData,function(f,g){c=[];for(a=0;a<e;a++)switch(c[a]=!1,d[a].operator){case "start":b="^"+d[a].value;null!==f[d[a].field].match(b)&&(c[a]=!0);break;case "end":b=d[a].value+"$";null!==f[d[a].field].match(b)&&(c[a]=!0);break;case "lt":case "<":f[d[a].field]<d[a].value&&(c[a]=!0);break;case "lte":case "le":case "<=":f[d[a].field]<=d[a].value&&(c[a]=!0);break;case "gt":case ">":f[d[a].field]>
d[a].value&&(c[a]=!0);break;case "gte":case "ge":case ">=":f[d[a].field]>=d[a].value&&(c[a]=!0);break;case "ne":case "neq":case "!=":f[d[a].field]!=d[a].value&&(c[a]=!0);break;default:f[d[a].field]==d[a].value&&(c[a]=!0)}return-1===$.inArray(!1,c)?!0:!1})},_sort:function(){var a,c,b=[];if(null===this.opts.sort||0===this.opts.sort.length)return!1;a=0;for(c=this.opts.sort.length;a<c;a++)b.push("ASC"===this.opts.sort[a].direction.toUpperCase()?this.opts.sort[a].field:"-"+this.opts.sort[a].field);this.opts.data.sort(n.apply(null,
b))}};l.zino=l.zino||{};l.zino.DataSource=k})(window);